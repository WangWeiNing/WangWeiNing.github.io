---
layout: post
title: "MySQL在多系统平台使用时大小写区分问题"
author: "Wang"
date: 2017-08-13 16:34:12
tags:
  - MySQL
---

## 简介：
MySQL在创建数据库或数据表时会对应的创建数据库文件或数据表文件，而创建文件需要受到文件系统的限制，其中一个限制就是文件名是否区分大小写问题，如果在不区分的情况下，我们是不能创建一个字母相同只是大小写不同的文件，反之则可以。

MySQL受这一限制，所以在各个平台上会有不同的行为，如果我们只是在单一平台上使用MySQL的话不会有太大问题，但是如果要在多平台之间使用MySQL就需要格外关注此行为带来的影响。
        

## 各个平台下MySQL默认大小写处理方式

### Windows

在Windows，MacOS平台使用MySQL时，我们对表的访问使用大写还是小写是不会影响结果的，但是我们不能创建同名的数据库或者表，即使大小写不一样。MySQL会将数据库文件名数据表文件名都转为小写。

### Unix

在Unix类系统使用MySQL时，我们要时刻注意SQL中数据库或表的名称大小写，如果写错SQL语句就会出错，但是我们可以创建同名的数据库或者表，在大小写不一样的情况下。MySQL会保留数据库或数据表文件名的大小写。

## lower_case_table_names

上面说的是在各个平台使用MySQL时的默认行为，既然是默认行为那么肯定就有可选行为了，MySQL给出了三种不同的策略可供使用，可通过设置lower_case_table_name来修改此行为，有效值为可以是0,1,2。

|有效值|行为|
---|:--:
0|数据表和数据库的名称保存在磁盘时保留大小写，名称比对时(当你在sql语句中使用表名或数据库名时)使用区分策略。你不应该设置这个值在一个insensitive系统（例:Windows, MacOS）,如果你强制使用这个值在insensitive系统，并且使用大小写混用的sql语句去访问一个MyISAM表，那么会导致索引损坏。
1|数据表和数据库的名称是用小写保存在磁盘上，名称比对时使用insensitive策略，在查询和存储时MySQL转换所有表名为小写，这行为也应用于数据库名和表的别名。
2|数据表和数据库的名称保存在磁盘时保留大小写，当在查询或比较时MySQL都会将其转为小写。这选项值只工作在insensitive策略的文件系统。


0是多数unix系统的默认值，而1就是Windows或MacOS等insensitive系统的默认值。

接下来是关键问题，如果我们要在不同的平台间使用MySQL那么需要怎么做？首先，我们希望的是，我们即使在不同的平台间使用MySQL也不会有以下问题。

1. SQL语句无效
2. 无法进行数据传输


首先为什么会有以上问题呢？假设你在自己本地创建了数据库名为Game，后来你使用mysqldump将数据库传输到了一台linux服务器上，这时你发现你的服务器在启动时报错了，原因是*Use Game*时提示没有这个数据库，于是你用*mysql client*连接到*mysql server*并使用*show databases*查看数据库列表，但是你惊讶的发现，数据库Game变为了game。这是一个常见的问题，除此之外类似的问题还有可能发生在表上。


要解决以上问题，我们有几种不同的选择
1. 全部平台设置lower_case_table_name选项为1，这样我们所有的表与数据库都为小写命名，多平台间保持一致就会解决这个问题。

2. 如果一定需要大小写混用那么就考虑在unix平台保持lower_case_table_name选项值为0，windows将值设为2，这样我们就可以大小写混用了，
但是一定注意不能再linux平台上创建名称一样，但大小写不一样的数据库和表。